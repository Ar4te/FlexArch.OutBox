name: Pull Request æ£€æŸ¥

on:
  pull_request:
    branches: [master, develop]

env:
  DOTNET_VERSION: "8.0.x"

jobs:
  pr-validation:
    name: PR éªŒè¯
    runs-on: ubuntu-latest

    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: ${{ env.DOTNET_VERSION }}

      - name: æ¢å¤ä¾èµ–é¡¹
        run: dotnet restore

      - name: ä»£ç æ ¼å¼æ£€æŸ¥
        run: dotnet format --verify-no-changes --verbosity diagnostic

      - name: æ„å»ºæ£€æŸ¥
        run: dotnet build -c Release --no-restore -p:TreatWarningsAsErrors=true

      - name: è¿è¡Œæµ‹è¯•
        run: dotnet test --no-build --configuration Release --logger "console;verbosity=detailed"

      - name: é‡‡é›†æµ‹è¯•è¦†ç›–ç‡
        run: dotnet test --no-build --configuration Release --collect:"XPlat Code Coverage" --results-directory ./coverage

      - name: ä¸Šä¼ è¦†ç›–ç‡ç»“æœ
        uses: actions/upload-artifact@v4
        with:
          name: code-coverage
          path: ./coverage

      - name: PR æ£€æŸ¥å®Œæˆ
        run: |
          echo "âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼PR å¯ä»¥åˆå¹¶ã€‚"
          echo "ğŸ“Š æ„å»ºçŠ¶æ€: é€šè¿‡"
          echo "ğŸ§ª æµ‹è¯•çŠ¶æ€: é€šè¿‡" 
          echo "ğŸ“ æ ¼å¼æ£€æŸ¥: é€šè¿‡"
